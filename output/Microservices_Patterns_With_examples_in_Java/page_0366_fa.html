<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحه 366</title>
    <link rel="stylesheet" href="fontiran.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: IRANSansX, Tahoma, Arial, sans-serif;
            line-height: 1.8;
            text-align: right;
            direction: rtl;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
        }
        .chapter-content {
            margin-bottom: 20px;
            text-align: right;
            direction: rtl;
        }
        .translated-content {
            font-size: 14pt;
            margin-bottom: 15px;
            text-align: right;
            direction: rtl;
        }
        .page-images {
            text-align: center;
            margin: 20px 0;
            page-break-before: always;
        }
        .page-image {
            margin: 10px 0;
            text-align: center;
        }
        .page-image img {
            max-width: 100%;
            height: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .code-block {
            direction: ltr;
            text-align: left;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', Courier, monospace;
        }
        .english-text {
            direction: ltr;
            text-align: left;
            display: inline-block;
        }
        .heading {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
            text-align: right;
            direction: rtl;
        }
        .paragraph {
            margin-bottom: 15px;
            text-align: right;
            direction: rtl;
        }
        ul, ol {
            padding-right: 20px;
            padding-left: 0;
            text-align: right;
            direction: rtl;
        }
        li {
            margin-bottom: 10px;
            text-align: right;
            direction: rtl;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            text-align: right;
            direction: rtl;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
            direction: rtl;
        }
        th {
            background-color: #f8f9fa;
        }
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>
<body>
    <div class="chapter-content">
        <div class="translated-content">
             <div>
  <h3>Testing microservices:</h3>
  <p>
   <strong>Part 2</strong>
  </p>
  <p>
   The shouldSuccessfullyCreateTicket() test method sends a CreateTicket com-
   mand message and verifies that the reply contains the expected data. It uses Saga-
   MessagingTestHelper, which is a test helper class that synchronously sends and receives
   messages.
  </p>
  <p>
   The consumer-driven contract integration tests for Order Service verify that its API
   meets its clients’ expectations. Listing 10.3 shows HttpBase, which is the base class
   for the test class code-generated by Spring Cloud Contract. It’s responsible for the
   setup phase of the test. It creates the controllers injected with mock dependencies
   and configures those mocks to return values that cause the controller to generate the
   expected response.
  </p>
  <p>
   The shouldSaveAndLoadOrder() test method executes two transactions. The first
   saves a newly created Order in the database. The second transaction loads the Order
   and verifies that its fields are properly initialized.
  </p>
  <p>
   In this example, the deployment pipeline is fully automated.
  </p>
  <p>
   ...
  </p>
  <p>
   Let’s now look at how to write provider-side integration tests.
  </p>
  <p>
   <strong>WRITING PROVIDER-SIDE, CONSUMER-DRIVEN CONTRACT TESTS FOR ASYNCHRONOUS
   REQUEST/RESPONSE INTERACTIONS</strong>
  </p>
  <p>
   A provider-side integration test must verify that the provider handles a command mes-
   sage by sending the correct reply. Spring Cloud Contract generates test classes that
   have a test method for each contract. Each test method sends the contract’s input
   message and verifies that the reply matches the contract’s output message.
  </p>
  <p>
   The provider-side integration tests for Kitchen Service test KitchenService-
   CommandHandler. The KitchenServiceCommandHandler class handles a message by
   invoking KitchenService. The following listing shows the AbstractKitchenService-
   ConsumerContractTest class, which is the base class for the Spring Cloud Contract-
   generated tests. It creates a KitchenServiceCommandHandler injected with a mock
   KitchenService.
  </p>
  <p>
   <pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest(classes = 
AbstractKitchenServiceConsumerContractTest.TestConfiguration.class,
webEnvironment = SpringBootTest.WebEnvironment.NONE)
@AutoConfigureStubRunner(ids =
      
{&quot;net.chrisrichardson.ftgo.contracts:ftgo-kitchen-service-contracts&quot;},
workOffline = false)</code></pre>
  </p>
  <p>
   ...
  </p>
  <p>
   Let’s now look at how to write integration tests.
  </p>
  <p>
   <strong>10.2.1 Defining acceptance tests</strong>
  </p>
  <p>
   Acceptance tests، business-facing تست هایی برای یک component نرم‌افزاری هستند. آنها رفتار مورد نظر externally visible را از دیدگاه clients component به‌جای اصطلاحات implementation داخلی، شرح می‌دهند. این تست ها از user stories یا use cases ها مشتق شده‌اند. به عنوان مثال، یکی از key stories ها برای Order Service، داستان Place Order است:
  </p>
  <p>
   As a consumer of the Order Service
   I should be able to place an order
  </p>
  <p>
   We can expand this story into scenarios such as the following:
  </p>
  <p>
   Given a valid consumer
  </p>
  <p>
   Given using a valid credit card
  </p>
  <p>
   Given the restaurant is accepting orders
  </p>
  <p>
   When I place an order for Chicken Vindaloo at Ajanta
  </p>
  <p>
   Then the order should be APPROVED
  </p>
  <p>
   And an OrderAuthorized event should be published
  </p>
  <p>
   This scenario describes the desired behavior of Order Service in terms of its API.
  </p>
  <p>
   Each scenario defines an acceptance test. The givens correspond to the test’s setup
   phase, the when maps to the execute phase, and the then and the and to the verifica-
   tion phase. Later, you see a test for this scenario that does the following:
  </p>
  <ol>
   <li>
    Creates an Order by invoking the POST /orders endpoint
   </li>
   <li>
    Verifies the state of the Order by invoking the GET /orders/{orderId} endpoint
   </li>
   <li>
    Verifies that the Order Service published an OrderAuthorized event by sub-
    scribing to the appropriate message channel
   </li>
  </ol>
  <p>
   We could translate each scenario into Java code. An easier option, though, is to write
   the acceptance tests using a DSL such as Gherkin.
  </p>
  <p>
   <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArMAAAG9CAYAAADX3R5kAAAgAElEQVR4nO3dfZBU1ZXHP93xJgI7wZlM2cZmds10T+cI2N5Jd4b33f7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v
        </div>
    </div>
    <div class="page-images">
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            if (window.Prism) {
                Prism.highlightAll();
            }
        });
    </script>
</body>
</html>