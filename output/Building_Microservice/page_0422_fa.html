<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحه 422</title>
    <link rel="stylesheet" href="fontiran.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: IRANSansX, Tahoma, Arial, sans-serif;
            line-height: 1.8;
            text-align: right;
            direction: rtl;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
        }
        .chapter-content {
            margin-bottom: 20px;
            text-align: right;
            direction: rtl;
        }
        .translated-content {
            font-size: 14pt;
            margin-bottom: 15px;
            text-align: right;
            direction: rtl;
        }
        .page-images {
            text-align: center;
            margin: 20px 0;
            page-break-before: always;
        }
        .page-image {
            margin: 10px 0;
            text-align: center;
        }
        .page-image img {
            max-width: 100%;
            height: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .code-block {
            direction: ltr;
            text-align: left;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', Courier, monospace;
        }
        .english-text {
            direction: ltr;
            text-align: left;
            display: inline-block;
        }
        .heading {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
            text-align: right;
            direction: rtl;
        }
        .paragraph {
            margin-bottom: 15px;
            text-align: right;
            direction: rtl;
        }
        ul, ol {
            padding-right: 20px;
            padding-left: 0;
            text-align: right;
            direction: rtl;
        }
        li {
            margin-bottom: 10px;
            text-align: right;
            direction: rtl;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            text-align: right;
            direction: rtl;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
            direction: rtl;
        }
        th {
            background-color: #f8f9fa;
        }
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>
<body>
    <div class="chapter-content">
        <div class="translated-content">
            <div>
    <p>مدت زمانی زنده بود و به‌خوبی رفتار می‌کرد، و بار قابل توجهی را مدیریت می‌کرد. در آن زمان ما باید حدود 6000–7000 <em>request</em> (درخواست) در ثانیه در زمان اوج را مدیریت می‌کردیم، و اگرچه بیشتر آن توسط <em>reverse proxies</em> (پراکسی‌های معکوس) که در جلوی سرورهای <em>application</em> (برنامه) ما قرار داشتند، بسیار <em>cached</em> (کش) شده بود، جستجوها برای محصولات (مهمترین جنبه سایت) بیشتر <em>uncached</em> (کش‌نشده) بودند و به یک <em>server round trip</em> (رفت و برگشت کامل سرور) نیاز داشتند.</p>
    <p>صبح یک روز، درست قبل از اینکه به اوج ناهار روزانه خود برسیم، سیستم شروع به رفتار کند کرد، و سپس شروع به شکست کرد. ما مقداری نظارت روی <em>application</em> (برنامه) اصلی جدید خود داشتیم، به اندازه‌ای که به ما بگوید که هر یک از گره‌های <em>application</em> (برنامه) ما به یک <em>CPU spike</em> (افزایش ناگهانی <em>CPU</em>) 100٪ می‌رسید، که بسیار بالاتر از سطوح عادی حتی در اوج بود. در یک بازه زمانی کوتاه، کل سایت از کار افتاد.</p>
    <p>ما موفق شدیم مقصر را ردیابی کنیم و سایت را دوباره راه‌اندازی کنیم. مشخص شد که این یکی از سیستم‌های تبلیغاتی پایین‌دستی است، که برای این مطالعه موردی ناشناس، ما می‌گوییم مسئول تبلیغات مربوط به <em>turnip</em> (شلغم) بود. <em>Turnip ad service</em> (سرویس تبلیغات شلغم)، یکی از قدیمی‌ترین و کم‌فعال‌ترین <em>services</em> (سرویس‌ها)، شروع به پاسخگویی بسیار کند کرد.</p>
    <p>پاسخگویی بسیار کند یکی از بدترین حالت‌های شکست است که شما می‌توانید تجربه کنید. اگر یک سیستم فقط وجود نداشته باشد، شما خیلی سریع متوجه می‌شوید. وقتی فقط کند است، شما در نهایت مدتی منتظر می‌مانید قبل از اینکه تسلیم شوید—این فرآیند انتظار می‌تواند کل سیستم را کند کند، باعث ایجاد <em>resource contention</em> (رقابت بر سر منابع) شود، و، همانطور که در مورد ما اتفاق افتاد، منجر به یک شکست آبشاری شود. اما هر چه علت شکست باشد، ما سیستمی ایجاد کرده بودیم که در برابر یک مشکل پایین‌دستی که باعث شکست در سراسر سیستم می‌شود، آسیب‌پذیر بود. یک <em>service</em> (سرویس) پایین‌دستی، که ما کنترل کمی روی آن داشتیم، توانست کل سیستم ما را از کار بیاندازد.</p>
    <p>در حالی که یک تیم به مشکلات مربوط به سیستم شلغم نگاه می‌کرد، بقیه ما شروع به بررسی آنچه در <em>application</em> (برنامه) ما اشتباه پیش رفته بود، کردیم. ما چند مشکل پیدا کردیم، که در شکل 12-2 توضیح داده شده است. ما از یک <em>HTTP connection pool</em> (استخر اتصال <em>HTTP</em>) برای مدیریت اتصالات پایین‌دستی خود استفاده می‌کردیم. <em>threads</em> (رشته‌ها) در خود استخر، <em>time-outs</em> (مهلت زمانی) برای مدت زمانی که منتظر می‌ماندند در هنگام برقراری تماس <em>HTTP</em> پایین‌دستی، تنظیم شده بودند، که خوب است.
    مشکل این بود که کارگران همگی مدتی طول می‌کشید تا به دلیل <em>service</em> (سرویس) کند پایین‌دستی، منقضی شوند. در حالی که آنها منتظر بودند، <em>requests</em> (درخواست‌های) بیشتری به استخر رفتند و <em>worker threads</em> (رشته‌های کاری) را درخواست کردند. با عدم وجود کارگران در دسترس، این <em>requests</em> (درخواست‌ها) خودشان آویزان شدند. مشخص شد که کتابخانه استخر اتصال که ما استفاده می‌کردیم، یک <em>time-out</em> (مهلت زمانی) برای انتظار کارگران داشت، اما این به‌طور پیش‌فرض غیرفعال بود! این منجر به تجمع عظیمی از <em>blocked threads</em> (رشته‌های مسدود شده) شد. <em>Application</em> (برنامه) ما معمولاً در هر زمان معین، 40 اتصال همزمان داشت.
    در عرض پنج دقیقه، این وضعیت باعث شد که ما حدود 800 اتصال را به اوج برسانیم و سیستم را از کار بیندازیم.</p>
    <p><em>396 | Chapter 12: Resiliency</em></p>
</div>

        </div>
    </div>
    <div class="page-images">
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            if (window.Prism) {
                Prism.highlightAll();
            }
        });
    </script>
</body>
</html>