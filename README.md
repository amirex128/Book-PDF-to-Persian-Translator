# Book PDF to Persian Translator

این پروژه شامل اسکریپت‌هایی برای:
1. استخراج متن و تصاویر از کتاب‌های PDF صفحه به صفحه
2. ترجمه متن استخراج شده به فارسی با استفاده از هوش مصنوعی Google Gemini
3. تبدیل صفحات ترجمه شده به فایل PDF فارسی با فونت ایران سنس و تصاویر اصلی
4. حذف فایل‌های ترجمه شده در صورت نیاز

## نصب

1. نصب وابستگی‌های مورد نیاز:
```
pip install -r requirements.txt
```

2. نصب wkhtmltopdf (برای تبدیل HTML به PDF):
   - دانلود از [وب‌سایت رسمی wkhtmltopdf](https://wkhtmltopdf.org/downloads.html)
   - نصب آن روی سیستم خود
   - اطمینان از افزوده شدن آن به PATH سیستم

3. تنظیم کلیدهای API در فایل .env:
   - یک کپی از فایل `.env.example` ایجاد کرده و نام آن را به `.env` تغییر دهید
   - مقادیر موجود را با کلیدهای API خود جایگزین کنید:
     ```
     # Primary API key for Gemini (required)
     PRIMARY_API_KEY=your_primary_api_key_here
     
     # Additional API keys for fallback (optional, comma-separated)
     ADDITIONAL_API_KEYS=second_api_key,third_api_key
     ```
   - در صورت وجود چندین کلید API، سیستم به طور خودکار بین آن‌ها جابجا می‌شود (در صورت برخورد با محدودیت نرخ)

4. قرار دادن فایل‌های PDF کتاب در پوشه `books` (در صورت عدم وجود، آن را ایجاد کنید)

5. فونت ایران سنس:
   - فونت ایران سنس در پوشه `assets/Webfonts` قرار دارد و به صورت خودکار در فایل‌های HTML استفاده می‌شود
   - برای PDF نهایی نیز از همین فونت استفاده می‌شود

## ویژگی‌های اصلی

- استخراج و حفظ تصاویر موجود در PDF اصلی
- ترجمه متن به فارسی با حفظ تصاویر اصلی در خروجی نهایی
- پشتیبانی از فونت ایران سنس برای نمایش بهتر متن فارسی
- تبدیل خودکار به PDF با صفحه‌آرایی مناسب
- چرخش خودکار بین چندین کلید API برای جلوگیری از محدودیت‌های نرخ

## نحوه استفاده

### پردازش کامل (استخراج، ترجمه و تبدیل به PDF)

برای انجام کل فرایند با یک دستور، از اسکریپت `main.py` استفاده کنید:

```
python src/main.py
```

این اسکریپت:
- تمام فایل‌های PDF موجود در پوشه `books` را پردازش می‌کند
- برای هر PDF، یک پوشه با همان نام ایجاد می‌کند (اگر از قبل وجود داشته باشد، آن را حذف و دوباره ایجاد می‌کند)
- فایل‌های فونت ایران سنس را به پوشه خروجی کپی می‌کند
- متن و تصاویر هر صفحه را استخراج می‌کند
- هر صفحه را به فارسی ترجمه و به صورت فایل HTML با فونت ایران سنس و تصاویر اصلی ذخیره می‌کند
- همه فایل‌های HTML را به یک PDF واحد با پسوند "_fatsi" تبدیل می‌کند
- به فایل PDF بعدی می‌رود و تمام مراحل را تکرار می‌کند

### خروجی تمیز و ساده
- فایل‌های HTML و PDF تولید شده شامل متن ترجمه شده فارسی، تصاویر اصلی و شماره صفحه هستند
- متن اصلی انگلیسی حذف شده است
- قالب‌بندی ساده و تمیز با فونت ایران سنس

پارامترهای اختیاری:
- `--books_dir`: مسیر پوشه حاوی فایل‌های PDF (پیش‌فرض: `./books`)
- `--output_dir`: مسیر پوشه خروجی (پیش‌فرض: `./output`)
- `--limit`: حداکثر تعداد صفحات برای پردازش از هر کتاب (برای آزمایش مفید است)
- `--force`: بازنویسی ترجمه‌های موجود
- `--skip_pages`: لیست صفحاتی که باید رد شوند (مثال: "1,5,10")

مثال:
```
python src/main.py --limit 10 --force
```

### پردازش جداگانه استخراج و ترجمه

اگر می‌خواهید مراحل را جداگانه انجام دهید، هنوز می‌توانید از اسکریپت‌های زیر استفاده کنید:

#### استخراج متن از PDF

```
python pdf_to_txt.py
```

#### ترجمه متن به فارسی

```
python translate_books.py
```

### حذف فایل‌های ترجمه شده

برای حذف فایل‌های ترجمه شده برای یک کتاب خاص:

```
python delete_translations.py "نام-کتاب"
```

## نکات

- اسکریپت از Google Gemini API (مدل models/gemini-2.0-flash) برای ترجمه استفاده می‌کند
- کیفیت ترجمه به مدل Gemini بستگی دارد
- برای کتاب‌های بزرگ، از پارامتر `--limit` برای آزمایش روی تعداد کمی از صفحات استفاده کنید
- سیستم به طور خودکار بین کلیدهای API موجود در فایل `.env` جابجا می‌شود
- فایل‌های HTML و PDF فقط شامل متن ترجمه شده فارسی و شماره صفحه هستند
- PDF نهایی تولید شده با پسوند "_fatsi" در کنار فایل PDF اصلی ذخیره می‌شود 